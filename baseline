import numpy as np
import pandas as pd

from sklearn.datasets import load_breast_cancer
from sklearn.model_selection import train_test_split, KFold
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA

from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

import matplotlib.pyplot as plt

data = load_breast_cancer()

df = pd.DataFrame(data.data, columns=data.feature_names)
df["target"] = data.target

df.to_csv("practice.csv", index=False)

df = pd.read_csv("practice.csv")

X = df.drop(columns=["target"])
y = df["target"]

X_train, X_test, y_train, y_test = train_test_split(
X, y,
test_size=0.2,
random_state=42,
stratify=y
)

scaler = StandardScaler()
X_train_sc = scaler.fit_transform(X_train)
X_test_sc = scaler.transform(X_test)

kf = KFold(n_splits=5, shuffle=True, random_state=42)

C_list = [0.01, 0.1, 1, 10, 100] # 튜닝할 파라미터 후보
best_C = None
best_cv_acc = -1

for C in C_list:
cv_acc_list = []

for train_idx, val_idx in kf.split(X_train_sc):
    X_tr = X_train_sc[train_idx]
    y_tr = y_train.iloc[train_idx]

    X_val = X_train_sc[val_idx]
    y_val = y_train.iloc[val_idx]

    model = LogisticRegression(C=C, max_iter=5000)
    model.fit(X_tr, y_tr)

    pred_val = model.predict(X_val)
    acc_val = accuracy_score(y_val, pred_val)

    cv_acc_list.append(acc_val)

mean_acc = np.mean(cv_acc_list)

if mean_acc > best_cv_acc:
    best_cv_acc = mean_acc
    best_C = C
print("Best C:", best_C)
print("Best CV accuracy:", best_cv_acc)

pca = PCA(n_components=2)
X_train_pca = pca.fit_transform(X_train_sc)
X_test_pca = pca.transform(X_test_sc)

final_model = LogisticRegression(C=best_C, max_iter=5000)
final_model.fit(X_train_pca, y_train)

pred_test = final_model.predict(X_test_pca)
test_acc = accuracy_score(y_test, pred_test)

print("Test accuracy:", test_acc)

plt.figure()
plt.scatter(X_train_pca[:, 0], X_train_pca[:, 1], c=y_train.to_numpy(), s=15)
plt.title("Train (PCA 2D)")
plt.xlabel("PC1")
plt.ylabel("PC2")
plt.show()
